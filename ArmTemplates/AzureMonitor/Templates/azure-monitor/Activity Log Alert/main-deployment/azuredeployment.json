{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/managementGroupDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",

    "parameters": {
        "targetsub": {
            "type": "string"
        },
        "AlertRuleActionGroupName": {
            "type": "String",
            "metadata": {
                "displayName": "Action Group Name",
                "description": "Name of the action group to use with this alert."
            },
            "defaultValue": "email_me"
        },
        "RuleResourceGroupName": {
            "type": "String",
            "metadata": {
                "displayName": "Resource Group Name",
                "description": "Name of the Resource Group that will contain the rule.",
                "strongType": "existingResourceGroups"
            },
            "defaultValue": "rg-alerts"
        }
    },
    "variables": {
        "templateBaseUrl": "https://raw.githubusercontent.com/Andrew-Coughlin-MSFT/Azure/master/ArmTemplates/AzureMonitor/Templates",

        "linkedTemplates": {
            // Policy definitions
            "ActivityLogTemplate": "[concat(variables('templateBaseUrl'), '/azure-monitor/Activity Log Alert/template/azure-activity-log-alert-monitor/azuredeploy.json')]"

        }
    },
    "resources": [
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-06-01",
            "name": "network-networkSecurityGroups-write",
            "location": "[deployment().location]",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('linkedTemplates').ActivityLogTemplate]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "targetsub": {
                        "value": "[parameters('targetsub')]"
                    },
                    "actionGroupName": {
                        "value": "[parameters('AlertRuleActionGroupName')]"
                    },
                    "RuleResourceGroupName": {
                        "value": "[parameters('RuleResourceGroupName')]"
                    },
                    "operationName":{
                        "value":"Microsoft.Network/networkSecurityGroups/write"
                    },
                    "activityLogAlertName":{
                        "value":"Activity Log Alert - NSG Write"
                    }
                }
            }
        }
    ]
}